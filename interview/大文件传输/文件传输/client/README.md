# 原理步骤

1. 选择文件后，将文件切片，每一片都携带切片的总数和对应的 id。
2. 监听总的切片和正在上传切片数组的变化，一旦发生变化就通过最大并发数减去正在上传数得到需要添加的切片数量。
3. 截取并去除总切片数组的一组切片加入到上传数组，然后对这组切片遍历，启动上传任务，使用 try...catch。
4. 失败的片段重新加入到总切片数组并对其失败次数+1，等待重新上传。成功的加入到已上传数组，在 finally 最后将这个片段从上传数组中移除。
5. 由于我在监听上传数组的长度，一旦其长度发生变化，我又会重新计算要添加的切片数量。

# 网络好的情况下，切片上传和普通上传有什么区别？

1. 普通上传文件过大情况下浏览器会出现超时问题。
2. 切片上传：
   - 串行上传：频繁建立连接，需要等待上一个切片上传完成才能上传下一个切片。速度慢。消耗资源。
   - 并行上传：多个切片同时上传，可以提高上传速度。需考虑服务器是否具备处理并发的能力。

## 解决频繁建立连接

1. http1.1 的持久连接，可以减少建立连接的次数。设置 connection:keep-alive。建立 6 个长连接，但是会互相竞争带宽，前一个请求失败需要等待其成功。
2. http2.0 的多路复用，单个连接发送多个请求
